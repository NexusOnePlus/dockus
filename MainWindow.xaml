<Window x:Class="dockus.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:dd="urn:gong-wpf-dragdrop"
        xmlns:local="clr-namespace:dockus"
        xmlns:controls="clr-namespace:dockus.Dock.Controls"
        xmlns:converters="clr-namespace:dockus.Core.Converters"
        xmlns:core="clr-namespace:dockus.Core.Models"
        WindowStyle="None"
        Topmost="True"
        Background="Transparent"
        AllowsTransparency="True"
        Title="Dockus" 
        Height="80"
        SizeToContent="WidthAndHeight"
        ResizeMode="NoResize"
        WindowStartupLocation="Manual"
        Loaded="Window_Loaded"
        Closing="Window_Closing"
        SizeChanged="Window_SizeChanged"
        SourceInitialized="Window_SourceInitialized"
        MouseEnter="Window_MouseEnter"
        MouseLeave="Window_MouseLeave"
        ShowInTaskbar="False">

    <Border x:Name="MainBorder" 
            BorderBrush="#FF4A4A4A" 
            BorderThickness="1" 
            CornerRadius="24" 
            Padding="15,3"
            Background="{Binding Source={x:Static core:AppSettings.Current}, Path=DockBackground, Converter={StaticResource ColorToBrushConverter}}">

        <ScrollViewer Margin="0,0" 
                      HorizontalScrollBarVisibility="Auto" 
                      VerticalScrollBarVisibility="Disabled" 
                      VerticalContentAlignment="Center">
            <StackPanel Orientation="Horizontal">

                <ItemsControl ItemsSource="{Binding PinnedItems}"
                              dd:DragDrop.IsDragSource="True"
                              dd:DragDrop.IsDropTarget="True"
                              dd:DragDrop.UseDefaultDragAdorner="True"
                              dd:DragDrop.DropHandler="{Binding}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <controls:DockIcon />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <Border Width="6" 
                        Margin="8,16" 
                        CornerRadius="2" 
                        Background="#262626" 
                        BorderThickness="1,0,1,0">
                    <Border.ContextMenu>
                        <ContextMenu>
                            <ContextMenu.Resources>
                                <Style TargetType="MenuItem" BasedOn="{StaticResource AppMenuItemStyle}" />
                            </ContextMenu.Resources>
                            <MenuItem Header="Show Taskbar" Click="ToggleBar_Click"/>
                            <MenuItem Header="Configuration" Click="OpenSettings_Click"/>
                            <MenuItem Header="Close" Click="Exit_Click"/>
                        </ContextMenu>
                    </Border.ContextMenu>
                </Border>

                <ItemsControl ItemsSource="{Binding ActiveUnpinnedItems}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <controls:DockIcon />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <Border Width="6" 
                        Margin="8,16" 
                        CornerRadius="2" 
                        Background="#262626" 
                        BorderThickness="1,0,1,0">
                    <Border.ContextMenu>
                        <ContextMenu>
                            <ContextMenu.Resources>
                                <Style TargetType="MenuItem" BasedOn="{StaticResource AppMenuItemStyle}" />
                            </ContextMenu.Resources>
                            <MenuItem Header="Show Taskbar" Click="ToggleBar_Click"/>
                            <MenuItem Header="Configuration" Click="OpenSettings_Click"/>
                            <MenuItem Header="Close" Click="Exit_Click"/>
                        </ContextMenu>
                    </Border.ContextMenu>
                </Border>

                <controls:SystemInfo x:Name="SystemInfoControl" />

                <Popup x:Name="CustomMenu"
                       DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}"
                       Placement="Top"
                       VerticalOffset="-10"
                       StaysOpen="False"
                       HorizontalOffset="-10"
                       AllowsTransparency="True"
                       PopupAnimation="Slide">

                    <Border Background="#CC1E1E1E"               
                            BorderThickness="1"
                            BorderBrush="Gray"
                            CornerRadius="6" 
                            Padding="8">
                        <StackPanel>
                            <MenuItem Foreground="White"
                                      Style="{StaticResource PopupMenuItemStyle}"
                                      Header="Anclar a la barra"
                                      Click="Pin_Click"
                                      Visibility="{Binding IsPinned, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>

                            <MenuItem Foreground="White"
                                      Style="{StaticResource PopupMenuItemStyle}"
                                      Header="Desanclar de la barra"
                                      Click="Unpin_Click"
                                      Visibility="{Binding IsPinned, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        </StackPanel>
                    </Border>
                </Popup>
            </StackPanel>
        </ScrollViewer>
    </Border>
</Window>